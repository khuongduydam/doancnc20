#shopping-cart
  - unless @cart.order_items.empty?
    .container-fluid
      .table-responsive
        table.table
          tbody
            #order-items
              = render @order_items
      - if current_page?cart_path(@cart)
        .total-money      
          i.fa.fa-money
            |  = 
            span.total-price = number_with_delimiter(@cart.total_price, delimiter: '.')
          br
          br
          - if user_signed_in?  
            = link_to t('layouts.header.checkout'),new_order_member_path,class:'btn btn-info'
          - else
            = link_to t('layouts.header.checkout'),new_order_path,class:'btn btn-info'
              
    

javascript:
  quantity = $('input#order_item_quantity');
  cart_total = $('.total-money');
  button = $('tr').find('.btn-danger');
  total_items = $('.cart-text').text();
  quantity.on('change',function(){
    price = $(this).closest('tr').find('.price').text();
    number = parseFloat($(this).closest('tr').find('input#order_item_quantity').val())
    total = $(this).closest('tr').find('.total_price').text(price * number)
    total = total.text();
    id = $(this).closest('tr').attr('id');
    input = $(this).closest('tr').find('input#order_item_quantity')
    place = $(this).closest('tr').find('.order_item_quantity')
    sum = 0;
    $.each($('.total_price'),function(){
      sum += parseFloat($(this).text());
      $('span.total-price').text(sum);
    });
    $.ajax({
      url: "/#{params[:locale]}/order_items/",
      dataType:'script',
      data: {quantity: number, id: id}
    });
    value = parseInt(input.val())
    if (value <= 0)  {
      input.css('border-color','red')
      $('span.errors').empty()
      place.prepend('<span class="errors"> Can not less than 0</span>')
      $(this).css('margin-top','10%')
      $('span.errors').css({'position':'relative','top':'100px','color':'red'})
      $('a.btn.btn-info').attr('disabled','disabled')
      $('a.btn.btn-info').click(function(event){
        event.preventDefault();
      })
    }
    else if (value > "#{@product.quantity}") {
      input.css('border-color','red')
      $('span.errors').empty()
      place.prepend('<span class="errors"> Quantity is not enough</span>')
      $(this).css('margin-top','10%')
      $('span.errors').css({'position':'relative','top':'100px','color':'red'})
      $('a.btn.btn-info').attr('disabled','disabled')
      $('a.btn.btn-info').click(function(event){
        event.preventDefault();
      }) 
    }
    else if ( $('span.total-price').text() == "NaN" ) {
      input.css('border-color','red')
      $('span.errors').empty()
      place.prepend('<span class="errors"> Number allow only </span>')
      $(this).css('margin-top','10%')
      $('span.errors').css({'position':'relative','top':'100px','color':'red'})
      $('a.btn.btn-info').attr('disabled','disabled')
      $('a.btn.btn-info').click(function(event){
        event.preventDefault();
      }) 
    }
    else{
      input.css('border-color','#ccc')
      $(this).closest('tr').find('span.errors').remove()
      $(this).css('margin-top','20%')
      $('a.btn.btn-info').attr('disabled',false)
      $('a.btn.btn-info').off('click');
    }     
  });  
  $('.btn-danger.btn-xs').one('click',function(){
    price = $(this).closest('tr').find('.total_price').text();
    total = $('span.total-price').text();
    total = (parseFloat(total)-parseFloat(price));
    return $('span.total-price').text(total);
  });
  

  
